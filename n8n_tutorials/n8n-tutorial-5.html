<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>n8n 教學 (五)：讓 AI 參考向量資料庫回答 (RAG)</title>
    <meta name="description" content="n8n 教學系列最終篇，我們將建立一個 RAG (Retrieval-Augmented Generation) 應用，讓 AI 能夠查詢 Supabase 向量資料庫，並根據相似度最高的資料來回答您的問題。">
    <meta name="keywords" content="n8n教學, RAG, Retrieval-Augmented Generation, Supabase, 向量搜尋, Gemini, AI問答, Chatbot">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .tutorial-content img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1.5rem auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .tutorial-content figure {
            margin: 1.5rem 0;
            text-align: center;
        }
        .tutorial-content figure img {
            margin: 0 auto;
        }
        .step {
            margin-bottom: 2.5rem;
            padding: 2rem;
            border: 1px solid #dee2e6;
            border-radius: .5rem;
            background-color: #f8f9fa;
            transition: box-shadow 0.3s ease-in-out;
        }
        .step:hover {
            box-shadow: 0 .5rem 1rem rgba(0,0,0,.15);
        }
        .step h3 {
            font-size: 1.75rem;
            color: #0d6efd;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }
        .step h3 .step-icon {
            margin-right: 1rem;
            font-size: 1.5rem;
        }
        .tutorial-intro, .tutorial-summary {
            background-color: #e9f7ff;
            border-left: 5px solid #0d6efd;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        .alert-gemini {
            background-color: #fff3cd;
            border-color: #ffeeba;
            color: #856404;
        }
        .code-block {
            background-color: #212529;
            color: #f8f9fa;
            padding: 1rem;
            border-radius: .3rem;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container">
                <a class="navbar-brand" href="https://www.luke.ninja">Luke Hou 侯俊嘉個人網站</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item"><a class="nav-link" href="../index.html">首頁</a></li>
                        <li class="nav-item"><a class="nav-link" href="../n8n-tutorials.html">n8n 教學</a></li>
                        <li class="nav-item"><a class="nav-link" href="../resume.html">簡歷</a></li>
                        <li class="nav-item"><a class="nav-link" href="../portfolio.html">作品集</a></li>
                        <li class="nav-item"><a class="nav-link" href="../blog.html">分享</a></li>
                        <li class="nav-item"><a class="nav-link" href="../contact.html">聯絡我</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mt-5">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <article class="blog-post">
                    <h1 class="mb-3 display-5 border-bottom pb-3">n8n 教學 (五)：讓 AI 參考向量資料庫回答 (RAG)</h1>
                    <p class="text-muted mb-4">發布日期：2025年5月</p>

                    <div class="tutorial-intro">
                        <h4>最終章：打造您的第一個 RAG 應用</h4>
                        <p>歡迎來到 n8n 教學系列的最終篇！在前面的章節中，我們學會了如何將資料存入向量資料庫。現在，我們要來學習如何「利用」這些資料。本章將引導您建立一個完整的 RAG (Retrieval-Augmented Generation) 工作流，讓 AI 能夠根據您提出的問題，從 Supabase 中檢索最相關的資訊，並生成精準的回答。</p>
                    </div>

                     <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <strong><i class="fas fa-exclamation-triangle me-2"></i>重要提醒：</strong> 如果您的 API key 綁定在免費方案 (free tier) 且未啟用帳單，則 Gemini 經手的資料就有可能被作為訓練用，如有機敏資訊，並且一定要使用 Gemini 的話，請務必升級至付費方案，或使用地端 LLM，亦或是公司提供的 API。
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>

                    <div class="tutorial-content">
                        <section class="step-by-step">
                            <div class="step">
                                <h3><i class="fas fa-comments step-icon"></i>步驟一：設定聊天觸發器</h3>
                                <p>首先，建立一個新的工作流，並選擇以聊天訊息作為觸發方式。</p>
                                <ol>
                                    <li>建立一個新工作流，命名為 <code>n8nChatWithAI</code>。</li>
                                    <li>選擇觸發器時，點選 "On chat message"。這會讓工作流在您透過聊天介面傳送訊息時啟動。</li>
                                </ol>
                                <figure>
                                    <a href="5/image.png" target="_blank"><img src="5/image.png" alt="選擇聊天觸發器" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 1: 選擇 "On chat message" 作為起點</figcaption>
                                </figure>
                            </div>

                            <div class="step">
                                <h3><i class="fas fa-link step-icon"></i>步驟二：加入問答鏈 (Q&A Chain)</h3>
                                <p>接下來，我們加入一個核心元件 "Question and Answer Chain"，它會幫我們整合後續的語言模型和向量資料庫。</p>
                                <ol>
                                    <li>在觸發器後新增節點，搜尋 "question" 並選擇 "Question and Answer Chain"。</li>
                                    <li>點擊 "Add Option" 並選擇 "System Prompt Template"，讓我們可以客製化 AI 的指令。</li>
                                    <li>啟用 "Expression" 並貼上以下提示詞，為 AI 設定角色和任務：
                                        <div class="code-block mt-3">
                                            <pre><code>你是專業藥劑師，專長是台灣健保給付規範相關領域。
閱讀 Vector Store 的健保規範資料庫，了解台灣健保的相關規範，並以專業藥劑師的角度親切地回答使用者問題。
一律用繁體中文回應，但英文專有名詞則保留原文。

Context: {context}</code></pre>
                                        </div>
                                    </li>
                                </ol>
                                <figure>
                                    <a href="5/image%202.png" target="_blank"><img src="5/image%202.png" alt="加入 Q&A Chain" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 2: 新增 Question and Answer Chain 節點</figcaption>
                                </figure>
                                <figure>
                                    <a href="5/image%203.png" target="_blank"><img src="5/image%203.png" alt="設定系統提示詞" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 3: 客製化系統提示詞以指導 AI</figcaption>
                                </figure>
                            </div>

                            <div class="step">
                                <h3><i class="fas fa-brain step-icon"></i>步驟三：設定大型語言模型 (LLM)</h3>
                                <p>現在，我們要為 Q&A Chain 指定一個大腦，也就是我們選用的語言模型。</p>
                                <ol>
                                    <li>點擊 Q&A Chain 節點左下的 "鬚鬚"。</li>
                                    <li>選擇 "Google Gemini Chat Model"。</li>
                                    <li>選擇或建立您的 Gemini 憑證，並將 Model 選為 <code>models/gemini-2.5-flash</code> (或您偏好的模型)。</li>
                                </ol>
                                <figure>
                                    <a href="5/image%205.png" target="_blank"><img src="5/image%205.png" alt="選擇語言模型" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 4: 選擇 Google Gemini 作為語言模型</figcaption>
                                </figure>
                                <figure>
                                    <a href="5/image%206.png" target="_blank"><img src="5/image%206.png" alt="設定模型版本" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 5: 選擇指定的模型版本</figcaption>
                                </figure>
                            </div>

                            <div class="step">
                                <h3><i class="fas fa-database step-icon"></i>步驟四：設定向量資料庫檢索器</h3>
                                <p>這是 RAG 的核心：設定如何從我們的 Supabase 向量資料庫中檢索資訊。</p>
                                <ol>
                                    <li>點擊 Q&A Chain 節點右下的 "鬚鬚"，選擇 "Vector Store Retriever"。</li>
                                    <li>在跳出的視窗中，繼續點擊紅點上的 "+"，選擇 "Supabase Vector Store"。</li>
                                    <li><strong>設定 Supabase 連線:</strong>
                                        <ul>
                                            <li>選擇您的 Supabase 憑證。</li>
                                            <li>"Table Name" 選擇 <code>nhi_drug_768</code>。</li>
                                            <li>"Query Name" 改為 <code>match_nhi_drug_768</code>。</li>
                                        </ul>
                                    </li>
                                    <li><strong>設定 Embedding 模型:</strong>
                                        <ul>
                                            <li>在 Supabase Vector Store 節點下方的 "鬚鬚" 點擊 "+"。</li>
                                            <li>選擇 "Embeddings Google Gemini"。</li>
                                            <li>選擇您的 Gemini 憑證，並將 Model 設為 <code>models/text-embedding-004</code>。</li>
                                        </ul>
                                    </li>
                                </ol>
                                <figure>
                                    <a href="5/image%208.png" target="_blank"><img src="5/image%208.png" alt="選擇向量檢索器" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 6: 選擇 Vector Store Retriever</figcaption>
                                </figure>
                                <figure>
                                    <a href="5/image%2011.png" target="_blank"><img src="5/image%2011.png" alt="選擇 Supabase Vector Store" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 7: 將檢索器指向 Supabase</figcaption>
                                </figure>
                                <figure>
                                    <a href="5/image%2014.png" target="_blank"><img src="5/image%2014.png" alt="設定 Supabase 表格與函式" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 8: 設定要查詢的表格與函式</figcaption>
                                </figure>
                                <figure>
                                    <a href="5/image%2016.png" target="_blank"><img src="5/image%2016.png" alt="設定 Embedding 模型" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 9: 設定用於查詢的 Embedding 模型</figcaption>
                                </figure>
                            </div>

                            <div class="step">
                                <h3><i class="fas-fa-rocket step-icon"></i>步驟五：開始聊天與驗證</h3>
                                <p>所有節點都設定完畢！現在可以開始與您的 AI 聊天了。</p>
                                <ol>
                                    <li>點擊畫面下方的橘色按鈕 "Open chat"。</li>
                                    <li>在聊天視窗中，輸入您想詢問的健保用藥問題，例如：「Doxorubicin 有什麼健保使用限制?」</li>
                                    <li>AI 會接收您的問題，轉換為向量後至 Supabase 搜尋，最後將搜尋結果與您的問題結合，生成最終回覆。</li>
                                    <li>您可以比對 AI 的回答與 Supabase 資料庫中的原文，確認其準確性。</li>
                                </ol>
                                <figure>
                                    <a href="5/image%2019.png" target="_blank"><img src="5/image%2019.png" alt="開始聊天" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 10: 在聊天視窗中提出問題</figcaption>
                                </figure>
                                <figure>
                                    <a href="5/image%2020.png" target="_blank"><img src="5/image%2020.png" alt="AI 回覆" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 11: AI 根據向量資料庫的內容生成回答</figcaption>
                                </figure>
                                <figure>
                                    <a href="5/image%2022.png" target="_blank"><img src="5/image%2022.png" alt="驗證資料" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 12: 在 Supabase 中比對原始資料，驗證正確性</figcaption>
                                </figure>
                            </div>
                        </section>
                    </div>

                    <div class="tutorial-summary">
                        <h4>系列總結與展望</h4>
                        <p>恭喜您完成了整個 n8n 教學系列！您已經從零開始，成功地建立了一個功能完整的 RAG 應用。回顧整個系列，我們學會了：</p>
                        <ul>
                            <li><strong>環境建置：</strong> 在本地安裝 n8n。</li>
                            <li><strong>資料庫設定：</strong> 建立 Supabase 向量資料庫。</li>
                            <li><strong>API 申請：</strong> 取得 Gemini API Key。</li>
                            <li><strong>資料寫入：</strong> 建立工作流將文件轉換為向量並存入資料庫。</li>
                            <li><strong>資料檢索與生成 (RAG)：</strong> 建立工作流，讓 AI 根據私有資料回答問題。</li>
                        </ul>
                        <p>您現在所掌握的技能，是打造各種強大 AI 自動化應用的基礎。您可以嘗試替換不同的資料來源 (如 Notion、網頁爬蟲)、探索更複雜的 Prompt Engineering 技巧，或將結果輸出到不同的地方 (如 Email、Slack)。自動化的世界充滿無限可能，期待您創造出更多精彩的應用！</p>
                    </div>
                </article>

                <div class="mt-5 text-center">
                    <a href="../n8n-tutorials.html" class="btn btn-primary btn-lg"><i class="fas fa-arrow-left me-2"></i>返回 n8n 教學列表</a>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-light mt-5 py-3">
        <div class="container text-center">
            <p>&copy; 2025 侯俊嘉(Luke Hou). All rights reserved.</p>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/main.js"></script>
</body>
</html>