<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>n8n 教學 (四)：建立 n8n 工作流並寫入向量資料庫</title>
    <meta name="description" content="n8n 教學系列第四篇，本篇將帶您實際操作，建立一個完整 n8n 工作流，從讀取資料、生成向量、到最終寫入 Supabase 向量資料庫。">
    <meta name="keywords" content="n8n教學, n8n工作流, Supabase, 向量資料庫, 資料嵌入, 自動化流程, API整合">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .tutorial-content img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1.5rem auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .tutorial-content figure {
            margin: 1.5rem 0;
            text-align: center;
        }
        .tutorial-content figure img {
            margin: 0 auto;
        }
        .step {
            margin-bottom: 2.5rem;
            padding: 2rem;
            border: 1px solid #dee2e6;
            border-radius: .5rem;
            background-color: #f8f9fa;
            transition: box-shadow 0.3s ease-in-out;
        }
        .step:hover {
            box-shadow: 0 .5rem 1rem rgba(0,0,0,.15);
        }
        .step h3 {
            font-size: 1.75rem;
            color: #0d6efd;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }
        .step h3 .step-icon {
            margin-right: 1rem;
            font-size: 1.5rem;
        }
        .tutorial-intro, .tutorial-summary {
            background-color: #e9f7ff;
            border-left: 5px solid #0d6efd;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        .alert-gemini {
            background-color: #fff3cd;
            border-color: #ffeeba;
            color: #856404;
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container">
                <a class="navbar-brand" href="https://www.luke.ninja">Luke Hou 侯俊嘉個人網站</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item"><a class="nav-link" href="../index.html">首頁</a></li>
                        <li class="nav-item"><a class="nav-link" href="../n8n-tutorials.html">n8n 教學</a></li>
                        <li class="nav-item"><a class="nav-link" href="../resume.html">簡歷</a></li>
                        <li class="nav-item"><a class="nav-link" href="../portfolio.html">作品集</a></li>
                        <li class="nav-item"><a class="nav-link" href="../blog.html">分享</a></li>
                        <li class="nav-item"><a class="nav-link" href="../contact.html">聯絡我</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mt-5">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <article class="blog-post">
                    <h1 class="mb-3 display-5 border-bottom pb-3">n8n 教學 (四)：建立工作流並寫入向量資料庫</h1>
                    <p class="text-muted mb-4">發布日期：2025年5月</p>

                    <div class="tutorial-intro">
                        <h4>前言</h4>
                        <p>理論準備完畢，現在是動手實作的時刻！本章節是系列教學的核心，我們將整合前幾章的成果，從無到有建立一個完整的 n8n 工作流。這個工作流會自動讀取指定的資料，透過 Gemini API 將其轉換為向量 (Embeddings)，最後存入我們在 Supabase 中建立的向量資料庫。讓我們開始吧！</p>
                    </div>

                    <div class="alert alert-gemini alert-dismissible fade show" role="alert">
                        <strong><i class="fas fa-exclamation-triangle me-2"></i>重要提醒：</strong> 如果您的 Gemini API key 綁定在免費方案 (free tier) 且未啟用帳單，則 Gemini 處理的資料可能被用於模型訓練。若涉及機敏資訊且必須使用 Gemini，請務必升級至付費方案。
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>

                    <div class="tutorial-content">
                        <section class="step-by-step">
                            <div class="step">
                                <h3><i class="fas fa-plus-circle step-icon"></i>步驟一：建立新的工作流 (Workflow)</h3>
                                <p>登入您的 n8n 介面，點擊 "Add workflow" 來建立一個全新的空白工作流。</p>
                                <figure>
                                    <a href="4/image.png" target="_blank"><img src="4/image.png" alt="建立新工作流" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 1: 點擊 Add workflow</figcaption>
                                </figure>
                            </div>

                            <div class="step">
                                <h3><i class="fas fa-cogs step-icon"></i>步驟二：設定觸發器 (Trigger)</h3>
                                <p>工作流需要一個起點。我們使用手動觸發，方便測試。</p>
                                <ol>
                                    <li>點擊畫面中的 "+" 按鈕，搜尋並選擇 "Manual" (或 "On App Launch") 作為觸發器。</li>
                                    <li>這個節點不需要特別設定，它提供了一個「執行」按鈕讓我們隨時啟動工作流。</li>
                                </ol>
                                <figure>
                                    <a href="4/image%202.png" target="_blank"><img src="4/image%202.png" alt="設定手動觸發器" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 2: 選擇 Manual 觸發器</figcaption>
                                </figure>
                            </div>

                            <div class="step">
                                <h3><i class="fas fa-file-alt step-icon"></i>步驟三：讀取文字資料 (Read Text File)</h3>
                                <p>接下來，我們要讀取本地的文字檔案作為資料來源。</p>
                                <ol>
                                    <li>點擊觸發器節點右邊的 "+"，搜尋並新增 "Read Text File" 節點。</li>
                                    <li>在 "File Path" 欄位，填入您要讀取的文字檔案的<strong>絕對路徑</strong>。</li>
                                    <li>點擊 "Execute Node" 測試，確認可以成功讀取到檔案內容。</li>
                                </ol>
                                <figure>
                                    <a href="4/image%204.png" target="_blank"><img src="4/image%204.png" alt="設定讀取文字檔案節點" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 3: 設定檔案路徑並測試</figcaption>
                                </figure>
                            </div>

                            <div class="step">
                                <h3><i class="fas fa-robot step-icon"></i>步驟四：連接 Gemini API (Google AI)</h3>
                                <p>現在，我們要將讀取到的文字轉換成向量。</p>
                                <ol>
                                    <li>新增 "Google AI" 節點。</li>
                                    <li>在 "Authentication" 選擇 "API Key"。</li>
                                    <li>點擊 "Create New" 建立一個新的憑證。貼上您在上一章節取得的 Gemini API Key，並儲存。</li>
                                    <li>在 "Resource" 選擇 "Embedding"，"Model" 選擇 "embedding-001"。</li>
                                    <li>在 "Text" 欄位，點擊右邊的 "Add Expression"，從 "Nodes" -> "Read Text File" -> "Output Data" -> "JSON" -> "data" 中，將 <code>{{ $json.data }}</code> 拖曳進來。這代表我們要將上一步讀取到的文字內容作為輸入。</li>
                                    <li>執行節點進行測試，成功後您會在 Output 中看到一長串由數字組成的 "embedding" 陣列。</li>
                                </ol>
                                <figure>
                                    <a href="4/image%2014.png" target="_blank"><img src="4/image%2014.png" alt="設定 Google AI 節點" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 4: 設定 Gemini Embedding</figcaption>
                                </figure>
                            </div>

                            <div class="step">
                                <h3><i class="fas fa-database step-icon"></i>步驟五：連接 Supabase 並寫入資料</h3>
                                <p>最後一步，將生成的向量和原始文字存入 Supabase。</p>
                                <ol>
                                    <li>新增 "Supabase" 節點。</li>
                                    <li>同樣地，建立新的 Supabase 憑證。您需要填寫兩項資訊：
                                        <ul>
                                            <li><strong>API URL:</strong> 在 Supabase 專案的 "Settings" -> "API" -> "Project URL" 中找到。</li>
                                            <li><strong>API Key:</strong> 使用您在第二章取得的 <code>service_role</code> 金鑰。</li>
                                        </ul>
                                    </li>
                                    <li>在 "Resource" 選擇 "Database/RPC"，"Operation" 選擇 "Insert"。</li>
                                    <li>在 "Table" 欄位選擇我們建立的 <code>nhi_drug_768</code>。</li>
                                    <li>在 "Columns" 區塊，我們要對應資料表的三個欄位：
                                        <ul>
                                            <li><code>content</code>: 使用 Expression，從 "Read Text File" 節點中拖入文字內容 <code>{{ $('Read Text File').item.json.data }}</code>。</li>
                                            <li><code>metadata</code>: 輸入一個簡單的 JSON 物件，例如 <code>{"source": "local_file"}</code>。</li>
                                            <li><code>embedding</code>: 使用 Expression，從 "Google AI" 節點中拖入向量資料 <code>{{ $('Google AI').item.json.embedding }}</code>。</li>
                                        </ul>
                                    </li>
                                    <li>執行節點，如果一切順利，資料就會成功寫入 Supabase！</li>
                                </ol>
                                <figure>
                                    <a href="4/image%2049.png" target="_blank"><img src="4/image%2049.png" alt="設定 Supabase 節點" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 5: 設定 Supabase Insert 操作</figcaption>
                                </figure>
                            </div>

                            <div class="step">
                                <h3><i class="fas fa-check-circle step-icon"></i>步驟六：驗證結果</h3>
                                <p>回到 Supabase 的 "Table Editor"，查看您的 <code>nhi_drug_768</code> 資料表。您應該會看到一筆新的紀錄，其中 <code>content</code> 是您的原文，<code>embedding</code> 欄位顯示 "[vector]"，代表向量資料已成功存入。</p>
                                <figure>
                                    <a href="4/image%2056.jpg" target="_blank"><img src="4/image%2056.jpg" alt="驗證 Supabase 資料" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 6: 在 Supabase 中確認資料已寫入</figcaption>
                                </figure>
                            </div>
                        </section>
                    </div>

                    <div class="tutorial-summary">
                        <h4>本章總結</h4>
                        <p>恭喜您！您已經成功建立並執行了第一個結合 AI 的 n8n 自動化工作流。在本章中，我們學會了：</p>
                        <ul>
                            <li>如何建立一個 n8n 工作流並設定手動觸發器。</li>
                            <li>讀取本地檔案作為資料來源。</li>
                            <li>串接 Google AI (Gemini) 節點，將文字轉換為 Embedding 向量。</li>
                            <li>串接 Supabase 節點，並將處理後的資料寫入指定的向量資料庫。</li>
                            <li>如何使用 Expression 將不同節點的資料串聯起來。</li>
                        </ul>
                        <p>現在您已經掌握了將資料 "存入" 向量資料庫的技巧。在最後一篇教學中，我們將探討如何 "取出" 這些資料，<a href="n8n-tutorial-5.html">讓 AI 參考向量資料庫的內容來回答問題</a>，完成一個簡易的 RAG (Retrieval-Augmented Generation) 應用。</p>
                    </div>
                </article>

                <div class="mt-5 text-center">
                    <a href="../n8n-tutorials.html" class="btn btn-primary btn-lg"><i class="fas fa-arrow-left me-2"></i>返回 n8n 教學列表</a>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-light mt-5 py-3">
        <div class="container text-center">
            <p>&copy; 2025 侯俊嘉(Luke Hou). All rights reserved.</p>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/main.js"></script>
</body>
</html>
