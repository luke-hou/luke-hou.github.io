<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>n8n 教學 (二)：Supabase 申請及建立向量資料庫</title>
    <meta name="description" content="n8n 教學系列第二篇，引導您申請 Supabase 帳號並建立向量資料庫，為 AI 應用提供資料儲存基礎。">
    <meta name="keywords" content="n8n教學, Supabase, 向量資料庫, pgvector, 資料庫建立, AI應用, PostgreSQL, RLS">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .tutorial-content img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1.5rem auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .tutorial-content figure {
            margin: 1.5rem 0;
            text-align: center;
        }
        .tutorial-content figure img {
            margin: 0 auto;
        }
        .step {
            margin-bottom: 2.5rem;
            padding: 2rem;
            border: 1px solid #dee2e6;
            border-radius: .5rem;
            background-color: #f8f9fa;
            transition: box-shadow 0.3s ease-in-out;
        }
        .step:hover {
            box-shadow: 0 .5rem 1rem rgba(0,0,0,.15);
        }
        .step h3 {
            font-size: 1.75rem;
            color: #0d6efd;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }
        .step h3 .step-icon {
            margin-right: 1rem;
            font-size: 1.5rem;
        }
        code {
            background-color: #e9ecef;
            padding: .2rem .4rem;
            border-radius: .2rem;
            font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: .875em;
        }
        pre {
            background-color: #212529;
            color: #f8f9fa;
            padding: 1rem;
            border-radius: .3rem;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        pre code {
            background-color: transparent;
            padding: 0;
            color: inherit;
            font-size: 1em;
        }
        .tutorial-intro, .tutorial-summary {
            background-color: #e9f7ff;
            border-left: 5px solid #0d6efd;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        .alert-gemini {
            background-color: #fff3cd;
            border-color: #ffeeba;
            color: #856404;
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container">
                <a class="navbar-brand" href="https://www.luke.ninja">Luke Hou 侯俊嘉個人網站</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item"><a class="nav-link" href="../index.html">首頁</a></li>
                        <li class="nav-item"><a class="nav-link" href="../n8n-tutorials.html">n8n 教學</a></li>
                        <li class="nav-item"><a class="nav-link" href="../resume.html">簡歷</a></li>
                        <li class="nav-item"><a class="nav-link" href="../portfolio.html">作品集</a></li>
                        <li class="nav-item"><a class="nav-link" href="../blog.html">分享</a></li>
                        <li class="nav-item"><a class="nav-link" href="../contact.html">聯絡我</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mt-5">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <article class="blog-post">
                    <h1 class="mb-3 display-5 border-bottom pb-3">n8n 教學 (二)：Supabase 申請及建立向量資料庫</h1>
                    <p class="text-muted mb-4">發布日期：2025年5月</p>

                    <div class="tutorial-intro">
                        <h4>前言</h4>
                        <p>在上一篇文章中，我們成功建置了 n8n 的本地環境。接下來，我們需要一個地方來儲存和管理我們的資料。本章將引導您完成 Supabase 的帳號申請，並建立一個強大的向量資料庫，這將是我們後續進行 AI 相關應用的核心基礎。</p>
                    </div>

                    <div class="alert alert-gemini alert-dismissible fade show" role="alert">
                        <strong><i class="fas fa-exclamation-triangle me-2"></i>重要提醒：</strong> 如果您的 Gemini API key 綁定在免費方案 (free tier) 且未啟用帳單，則 Gemini 處理的資料可能被用於模型訓練。若涉及機敏資訊且必須使用 Gemini，請務必升級至付費方案，或使用地端 LLM，亦或是公司提供的 API。
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>

                    <div class="tutorial-content">
                        <section class="step-by-step">
                            <div class="step">
                                <h3><i class="fas fa-user-plus step-icon"></i>步驟一：註冊 Supabase 帳號</h3>
                                <p>首先，前往 Supabase 官方網站並開始註冊流程。</p>
                                <p><a href="https://supabase.com/" target="_blank" class="btn btn-primary"><i class="fas fa-external-link-alt me-2"></i>前往 Supabase 官網</a></p>
                                <p>點擊 "Start your project"，然後選擇 "Sign Up Now" 使用 Email 進行註冊。填寫您的信箱和密碼，並完成信箱驗證。</p>
                                <figure>
                                    <a href="2/image.png" target="_blank"><img src="2/image.png" alt="Supabase官網首頁" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 1: 點擊 Start your project</figcaption>
                                </figure>
                                <figure>
                                    <a href="2/image%202.png" target="_blank"><img src="2/image%202.png" alt="Supabase註冊資訊填寫" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 2: 填寫註冊資訊並完成信箱驗證</figcaption>
                                </figure>
                            </div>

                            <div class="step">
                                <h3><i class="fas fa-sitemap step-icon"></i>步驟二：建立組織與專案</h3>
                                <p>登入後，首先需要建立一個「組織 (Organization)」，您可以將其視為一個工作區。接著，在組織內建立一個新的「專案 (Project)」。</p>
                                <ol>
                                    <li>點擊 "New Organization"，輸入組織名稱 (例如: <code>n8nTest</code>)，點擊 "Create Organization"。</li>
                                    <li>接著建立新專案，輸入專案名稱 (例如: <code>n8nProject</code>)。</li>
                                    <li><strong>請務必設定一組安全的資料庫密碼並妥善保存。</strong></li>
                                    <li>選擇離您最近的 Region (區域) 以獲得較低的延遲。</li>
                                    <li>點擊 "Create new project"。</li>
                                </ol>
                                <figure>
                                    <a href="2/image%204.png" target="_blank"><img src="2/image%204.png" alt="Supabase組織設定" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 3: 建立新組織</figcaption>
                                </figure>
                                <figure>
                                    <a href="2/image%205.png" target="_blank"><img src="2/image%205.png" alt="Supabase專案設定" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 4: 設定新專案資訊</figcaption>
                                </figure>
                            </div>

                            <div class="step">
                                <h3><i class="fas fa-database step-icon"></i>步驟三：建立向量資料表</h3>
                                <p>專案建立後，我們需要透過 SQL 來啟用 <code>pgvector</code> 擴充功能並建立儲存向量的資料表。</p>
                                <ol>
                                    <li>從左側選單進入 "SQL Editor"。</li>
                                    <li>點擊 "+ New query" 來新增一個查詢。</li>
                                    <li>將下方的 SQL 語法貼入查詢編輯器中。這段語法會：
                                        <ul>
                                            <li>啟用 <code>vector</code> 擴充功能。</li>
                                            <li>建立一個名為 <code>nhi_drug_768</code> 的資料表，包含 <code>content</code>、<code>metadata</code> 和 <code>embedding</code> (768 維) 欄位。</li>
                                            <li>建立一個名為 <code>match_nhi_drug_768</code> 的函式，用於後續的向量相似度搜尋。</li>
                                        </ul>
                                    </li>
                                </ol>
                                <pre><code class="language-sql">-- Enable the pgvector extension to work with embedding vectors
create extension if not exists vector;

-- Create a table to store your documents
create table nhi_drug_768 (
  id bigserial primary key,
  content text, -- corresponds to Document.pageContent
  metadata jsonb, -- corresponds to Document.metadata
  embedding vector(768) -- Ensure this dimension matches your embedding model
);

-- Create a function to search for documents
create function match_nhi_drug_768 (
  query_embedding vector(768),
  match_count int,
  filter jsonb DEFAULT '{}'
) returns table (
  id bigint,
  content text,
  metadata jsonb,
  similarity float
)
language plpgsql
as $$
#variable_conflict use_column
begin
  return query
  select
    id,
    content,
    metadata,
    1 - (embedding <=> query_embedding) as similarity
  from nhi_drug_768
  where metadata @> filter
  order by embedding <=> query_embedding
  limit match_count;
end;
$$;</code></pre>
                                <p>貼上語法後，點擊 "Run" 按鈕執行。成功後，您會在下方看到 "Success. No rows returned" 的訊息。</p>
                                <figure>
                                    <a href="2/image%209.png" target="_blank"><img src="2/image%209.png" alt="貼上SQL語法" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 5: 在 SQL Editor 中貼上語法並執行</figcaption>
                                </figure>
                            </div>

                            <div class="step">
                                <h3><i class="fas fa-shield-alt step-icon"></i>步驟四：啟用 RLS (Row Level Security)</h3>
                                <p>為了資料安全，我們必須為新建的資料表啟用 RLS。</p>
                                <ol>
                                    <li>從左側選單進入 "Table Editor"，您會看到剛剛建立的 <code>nhi_drug_768</code> 資料表。</li>
                                    <li>點擊資料表名稱，您會看到 "RLS is not enabled" 的提示。</li>
                                    <li>點擊 "Enable RLS" 按鈕，並在彈出視窗中確認啟用。</li>
                                    <li><strong>注意：</strong> 啟用 RLS 後，預設會拒絕所有存取，我們需要在後續步驟中設定適當的 Policy 才可讓 n8n 存取。</li>
                                </ol>
                                <figure>
                                    <a href="2/image%2014.png" target="_blank"><img src="2/image%2014.png" alt="Supabase資料表RLS disabled狀態" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 6: 點擊 Enable RLS</figcaption>
                                </figure>
                            </div>

                            <div class="step">
                                <h3><i class="fas fa-key step-icon"></i>步驟五：取得 API 金鑰</h3>
                                <p>最後，我們需要取得專案的 API 金鑰，以便 n8n 能夠連接到 Supabase。</p>
                                <ol>
                                    <li>從左側選單進入 "Project Settings" (專案設定)。</li>
                                    <li>選擇 "API" 分頁。</li>
                                    <li>在 "Project API Keys" 區塊，找到 <code>service_role</code> 的金鑰。</li>
                                    <li>點擊 "Reveal" 後再點擊 "Copy" 來複製這組金鑰。</li>
                                </ol>
                                <div class="alert alert-danger">
                                    <strong><i class="fas fa-exclamation-triangle me-2"></i>極度重要：</strong> <code>service_role</code> 金鑰擁有您資料庫的完整權限，等同於最高管理員。<strong>請務必將其存放在安全的地方 (如密碼管理器)，絕對不要外洩或直接寫在前端程式碼中。</strong>
                                </div>
                                <figure>
                                    <a href="2/image%2019.png" target="_blank"><img src="2/image%2019.png" alt="Supabase專案API金鑰" class="img-fluid"></a>
                                    <figcaption class="text-muted mt-2">圖 7: 複製 service_role 金鑰</figcaption>
                                </figure>
                            </div>
                        </section>
                    </div>

                    <div class="tutorial-summary">
                        <h4>本章總結</h4>
                        <p>做得好！您已經成功設定好 Supabase 並為我們的 AI 應用準備好了一個向量資料庫。回顧一下本章重點：</p>
                        <ul>
                            <li>完成 Supabase 帳號註冊、組織與專案的建立。</li>
                            <li>學會使用 SQL Editor 啟用 <code>pgvector</code> 並建立客製化的資料表與搜尋函式。</li>
                            <li>為資料表啟用 RLS，提升資料庫的安全性。</li>
                            <li>取得並妥善保存了具備完整權限的 <code>service_role</code> API 金鑰。</li>
                        </ul>
                        <p>在下一篇教學中，我們將會介紹 <a href="n8n-tutorial-3.html">如何申請 Gemini API Key</a>，為我們的自動化流程注入強大的 AI 生成能力。</p>
                    </div>
                </article>

                <div class="mt-5 text-center">
                    <a href="../n8n-tutorials.html" class="btn btn-primary btn-lg"><i class="fas fa-arrow-left me-2"></i>返回 n8n 教學列表</a>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-light mt-5 py-3">
        <div class="container text-center">
            <p>&copy; 2025 侯俊嘉(Luke Hou). All rights reserved.</p>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/main.js"></script>
</body>
</html>
