<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNOMED CT, FHIR èˆ‡ CQLï¼šé†«ç™‚äº’é€šæ€§éµä¸‰è§’æ·±åº¦åˆ†æ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap"
        rel="stylesheet">

    <!-- Chosen Palette: Modern Clinical Teal & Warm Slate. Background: #f8fafc (Slate 50), Primary: #0d9488 (Teal 600), Secondary: #475569 (Slate 600), Accent: #f59e0b (Amber 500) -->
    <!-- Application Structure Plan: 
         Updated Structure with Deep Dive:
         1. 'Overview': High-level context and value proposition.
         2. 'Structure': Interactive ontology explorer (Chart.js).
         3. 'Comparison': ICD vs SNOMED granularity (Chart.js Bar).
         4. 'Advanced Stack' (NEW): The core relation between FHIR, SNOMED, and CQL.
            - Visual Layer concept.
            - Interactive CQL Logic Engine Sandbox.
         5. 'Simulator': Basic mapping simulator.
         6. 'Roadmap': Timeline.
         
         The new 'Advanced' section is crucial for answering the specific prompt about CQL/FHIR relations.
    -->
    <!-- Visualization & Content Choices:
         - Advanced Section: Uses a "Layered Stack" UI layout to visually separate Structure, Meaning, and Logic.
         - CQL Sandbox: Uses simple JS logic to simulate an inference engine. It demonstrates "Subsumption" (Is-a relationships) which is the power of SNOMED+CQL.
         - CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    -->

    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
        }

        /* Custom Chart Container Styling */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 450px;
            background: white;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }

        .active-nav {
            border-bottom: 3px solid #0d9488;
            color: #0d9488;
            font-weight: 700;
        }

        .nav-item {
            transition: all 0.3s ease;
        }

        .nav-item:hover {
            color: #0d9488;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Logic Block Styling for CQL Section */
        .logic-block {
            transition: all 0.3s ease;
        }

        .logic-block:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -1px rgb(0 0 0 / 0.06);
        }
    </style>
</head>

<body class="flex flex-col min-h-screen">

    <!-- Navigation -->
    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-xl md:text-2xl font-bold text-teal-700">SNOMED CT <span
                            class="text-slate-600 text-sm md:text-lg font-normal">| äº’é€šæ€§éµä¸‰è§’åˆ†æ</span></span>
                </div>
                <div class="hidden md:flex space-x-4 items-center overflow-x-auto">
                    <button onclick="switchTab('overview')" id="nav-overview"
                        class="nav-item active-nav px-2 py-2 text-sm font-medium whitespace-nowrap">ç¸½è¦½</button>
                    <button onclick="switchTab('structure')" id="nav-structure"
                        class="nav-item px-2 py-2 text-sm font-medium whitespace-nowrap">çµæ§‹</button>
                    <button onclick="switchTab('advanced')" id="nav-advanced"
                        class="nav-item px-2 py-2 text-sm font-medium whitespace-nowrap bg-teal-50 text-teal-700 rounded-t">é€²éšï¼šFHIR/CQL</button>
                    <button onclick="switchTab('comparison')" id="nav-comparison"
                        class="nav-item px-2 py-2 text-sm font-medium whitespace-nowrap">æ²»ç†æ¯”è¼ƒ</button>
                    <button onclick="switchTab('simulator')" id="nav-simulator"
                        class="nav-item px-2 py-2 text-sm font-medium whitespace-nowrap">æ¨¡æ“¬å™¨</button>
                    <button onclick="switchTab('roadmap')" id="nav-roadmap"
                        class="nav-item px-2 py-2 text-sm font-medium whitespace-nowrap">è·¯å¾‘</button>
                    <a href="../blog.html"
                        class="nav-item px-2 py-2 text-sm font-medium whitespace-nowrap text-slate-500 hover:text-teal-600 ml-2 border-l pl-4 border-slate-300">
                        â†© å›éƒ¨è½æ ¼
                    </a>
                </div>
                <!-- Mobile Menu Button -->
                <div class="flex items-center md:hidden">
                    <button onclick="toggleMobileMenu()"
                        class="text-slate-600 hover:text-teal-600 focus:outline-none p-2">
                        <span class="text-2xl">â˜°</span>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-slate-50 border-t border-slate-200">
            <button onclick="switchTab('overview')"
                class="block w-full text-left px-4 py-2 hover:bg-slate-200 border-b border-slate-100">ç¸½è¦½èˆ‡åƒ¹å€¼</button>
            <button onclick="switchTab('structure')"
                class="block w-full text-left px-4 py-2 hover:bg-slate-200 border-b border-slate-100">çµæ§‹èˆ‡å±¤ç´š</button>
            <button onclick="switchTab('advanced')"
                class="block w-full text-left px-4 py-2 bg-teal-50 text-teal-800 font-bold border-b border-slate-100">é€²éšï¼šäº’é€šæ€§éµä¸‰è§’
                (FHIR/CQL)</button>
            <button onclick="switchTab('comparison')"
                class="block w-full text-left px-4 py-2 hover:bg-slate-200 border-b border-slate-100">ICD vs
                SNOMED</button>
            <button onclick="switchTab('simulator')"
                class="block w-full text-left px-4 py-2 hover:bg-slate-200 border-b border-slate-100">äº’é€šæ€§æ¨¡æ“¬</button>
            <button onclick="switchTab('roadmap')"
                class="block w-full text-left px-4 py-2 hover:bg-slate-200 border-b border-slate-100">å°ç£ç™¼å±•è·¯å¾‘</button>
            <a href="../blog.html"
                class="block w-full text-left px-4 py-2 bg-slate-100 text-slate-600 hover:bg-slate-200 font-bold">
                â†© å›éƒ¨è½æ ¼
            </a>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">

        <!-- SECTION 1: OVERVIEW -->
        <section id="overview" class="fade-in">
            <div class="mb-8 bg-white p-6 rounded-lg shadow-sm border-l-4 border-teal-500">
                <h1 class="text-3xl font-bold text-slate-800 mb-4">é†«ç™‚è³‡æ–™æ²»ç†çš„æ ¸å¿ƒå¼•æ“</h1>
                <p class="text-slate-600 leading-relaxed text-lg">
                    æœ¬å ±å‘Šåˆ†æäº† **SNOMED CT** åœ¨å°ç£æ¨å‹•æ™ºæ…§é†«ç™‚èˆ‡åœ‹éš›æ¥è»Œä¸­çš„é—œéµè§’è‰²ã€‚
                    è¦å¯¦ç¾çœŸæ­£çš„äº’é€šæ€§ï¼Œæˆ‘å€‘éœ€è¦ã€Œéµä¸‰è§’ã€ï¼š**FHIR** æä¾›æ¨™æº–å®¹å™¨ï¼Œ**SNOMED CT** æä¾›ç²¾ç¢ºå…§å®¹ï¼Œè€Œ **CQL** å‰‡æä¾›å¯åŸ·è¡Œçš„é‚è¼¯ã€‚
                </p>
                <div class="mt-4 flex gap-4">
                    <button onclick="switchTab('advanced')"
                        class="bg-teal-600 text-white px-4 py-2 rounded shadow hover:bg-teal-700 transition">æ·±å…¥äº†è§£äº’é€šæ€§éµä¸‰è§’
                        &rarr;</button>
                </div>
            </div>

            <!-- Consultant's Insight Block (NEW) -->
            <div class="mb-12 bg-indigo-50 border-l-4 border-indigo-600 p-6 rounded-r-lg shadow-sm">
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <span class="text-3xl">ğŸ’¡</span>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-lg font-bold text-indigo-900">è³‡æ·±é¡æ¯”ï¼šå¾ã€Œå¥ä¿ç”³å ±ã€åˆ°ã€Œåƒ¹å€¼é†«ç™‚ã€çš„è½‰å‹</h3>
                        <p class="mt-2 text-indigo-800 text-sm leading-relaxed">
                            åœ¨å°ç£ï¼Œè¨±å¤šé†«é™¢ CIO å¸¸å•ï¼šã€Œæˆ‘å€‘å·²æœ‰ ICD-10 ç”³å ±å¥ä¿ï¼Œç‚ºä½•é‚„éœ€è¦ SNOMEDï¼Ÿã€
                            <br><br>
                            å…¶å¯¦ï¼Œ<span class="font-bold border-b border-indigo-400">ICD æ˜¯ã€Œè·Ÿå¥ä¿ç½²è«‹æ¬¾çš„å¸³å–®ã€ï¼Œè€Œ SNOMED CT
                                å‰‡æ˜¯ã€Œé†«ç”Ÿå¯«çµ¦é†«ç”Ÿçœ‹çš„äº¤ç­æ—¥è¨˜ã€ã€‚</span>
                            å¸³å–®éœ€è¦çš„æ˜¯ã€Œæ­¸é¡ã€ä»¥ä¾¿è¨ˆåƒ¹ï¼ˆä¾‹å¦‚ï¼šè‚ºç‚ä¸€å¾‹çµ¦ä»˜ 3000 é»ï¼‰ï¼Œä½†æ—¥è¨˜éœ€è¦çš„æ˜¯ã€Œç²¾ç¢ºã€ä»¥ä¾¿æ•‘äººï¼ˆä¾‹å¦‚ï¼šå·¦ä¸‹è‚ºè‘‰é‡‘é»ƒè‰²è‘¡è„çƒèŒè‚ºç‚ï¼‰ã€‚
                            <br><br>
                            å¦‚æœä¸å°å…¥ SNOMED CTï¼Œæˆ‘å€‘çš„é†«ç™‚ AI æ¨¡å‹å°‡æ°¸é åªèƒ½å­¸åˆ°ã€Œå¸³å–®ç­‰ç´šã€çš„ç²—ç³™çŸ¥è­˜ï¼Œç„¡æ³•é‚å‘çœŸæ­£çš„ç²¾æº–é†«ç™‚ã€‚
                        </p>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                <!-- Card 1 -->
                <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow border border-slate-100 group cursor-pointer"
                    onclick="switchTab('structure')">
                    <div class="flex items-center justify-between mb-4">
                        <div
                            class="text-4xl text-teal-100 bg-teal-600 rounded-full w-12 h-12 flex items-center justify-center font-bold">
                            1</div>
                        <span class="text-sm text-slate-400">é»æ“Šè©³æƒ… &rarr;</span>
                    </div>
                    <h3 class="text-xl font-bold text-slate-800 mb-2 group-hover:text-teal-600">ç²¾ç¢ºçš„è‡¨åºŠèªæ„</h3>
                    <p class="text-slate-600 text-sm">çªç ´ ICD-10 çš„é¡†ç²’åº¦é™åˆ¶ã€‚å¾ã€Œä¸ç‰¹å®šè‚ºç‚ã€ç²¾é€²è‡³ã€Œå³è‚ºä¸‹è‘‰ç—…æ¯’æ€§è‚ºç‚ã€ï¼Œç‚º CDSS (è‡¨åºŠæ±ºç­–ç³»çµ±) æä¾›å¯ä¿¡æ•¸æ“šã€‚
                    </p>
                </div>

                <!-- Card 2 -->
                <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow border border-slate-100 group cursor-pointer"
                    onclick="switchTab('comparison')">
                    <div class="flex items-center justify-between mb-4">
                        <div
                            class="text-4xl text-blue-100 bg-blue-600 rounded-full w-12 h-12 flex items-center justify-center font-bold">
                            2</div>
                        <span class="text-sm text-slate-400">é»æ“Šè©³æƒ… &rarr;</span>
                    </div>
                    <h3 class="text-xl font-bold text-slate-800 mb-2 group-hover:text-blue-600">å¥ä¿èˆ‡è‡¨åºŠé›™è»Œä¸¦è¡Œ</h3>
                    <p class="text-slate-600 text-sm">è§£æ±ºã€ŒåŒç—…ç•°ç¢¼ã€ç—›é»ã€‚å¯¦ä½œ Automated Mappingï¼Œè®“é†«å¸«åªéœ€è¼¸å…¥ä¸€æ¬¡è‡¨åºŠè¨ºæ–·ï¼Œç³»çµ±è‡ªå‹•ç”¢å‡ºå¥ä¿ç¢¼èˆ‡SNOMEDç¢¼ã€‚
                    </p>
                </div>

                <!-- Card 3 -->
                <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow border border-slate-100 group cursor-pointer"
                    onclick="switchTab('advanced')">
                    <div class="flex items-center justify-between mb-4">
                        <div
                            class="text-4xl text-amber-100 bg-amber-500 rounded-full w-12 h-12 flex items-center justify-center font-bold">
                            3</div>
                        <span class="text-sm text-slate-400">é»æ“Šè©³æƒ… &rarr;</span>
                    </div>
                    <h3 class="text-xl font-bold text-slate-800 mb-2 group-hover:text-amber-600">æ™ºæ…§é†«é™¢è©•é‘‘åˆ©å™¨</h3>
                    <p class="text-slate-600 text-sm">ç¬¦åˆ HIMSS EMRAM èˆ‡å°ç£æ™ºæ…§é†«é™¢æ¨™ç« è¦æ±‚ã€‚é€é FHIR+CQL å¯¦ç¾è·¨é™¢äº’é€šèˆ‡è‡ªå‹•åŒ–å“è³ªæŒ‡æ¨™ç›£æ¸¬ã€‚</p>
                </div>
            </div>
        </section>

        <!-- SECTION 2: STRUCTURE (The Ontology) -->
        <section id="structure" class="hidden fade-in">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-slate-800 border-l-4 border-teal-500 pl-4">SNOMED CT çš„é‚è¼¯çµæ§‹</h2>
                <p class="mt-2 text-slate-600">
                    SNOMED CT æ˜¯å¤šé‡éšå±¤ (Poly-hierarchy) çš„æœ¬é«”è«– (Ontology)ã€‚
                    ä¸‹åœ–å±•ç¤ºäº†å…¶é ‚å±¤éšå±¤çš„åˆ†ä½ˆï¼Œé€™ç¨®çµæ§‹æ˜¯ CQL é€²è¡Œé‚è¼¯æ¨è«–çš„åŸºç¤ã€‚
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                <div class="flex flex-col items-center">
                    <div class="chart-container">
                        <canvas id="hierarchyChart"></canvas>
                    </div>
                    <p class="text-xs text-slate-400 mt-2 text-center">äº’å‹•å¼åœ–è¡¨ï¼šé»æ“Šå€å¡ŠæŸ¥çœ‹è©³ç´°èªªæ˜</p>
                </div>

                <div id="hierarchy-detail"
                    class="bg-white p-6 rounded-lg shadow-md border-t-4 border-slate-300 min-h-[350px]">
                    <h3 class="text-xl font-bold text-slate-800 mb-3" id="hierarchy-title">è«‹é»æ“Šå·¦å´åœ–è¡¨</h3>
                    <p class="text-slate-600 mb-4 leading-relaxed" id="hierarchy-desc">
                        SNOMED CT åŒ…å« 19 å€‹é ‚å±¤éšå±¤ã€‚é€é Is-a (æ˜¯ä¸€ç¨®) çš„é—œä¿‚ï¼Œç³»çµ±å¯ä»¥è‡ªå‹•æ¨è«–ã€‚ä¾‹å¦‚ï¼šæœå°‹ã€Œå‚³æŸ“ç—…ã€æœƒè‡ªå‹•åŒ…å«ã€ŒCOVID-19ã€ï¼Œå› ç‚ºåœ¨çµæ§‹æ¨¹ä¸­ COVID-19
                        æ˜¯å‚³æŸ“ç—…çš„å­ç¯€é»ã€‚
                    </p>
                    <div id="hierarchy-stats" class="hidden bg-slate-50 p-4 rounded border border-slate-200">
                        <h4 class="font-bold text-sm text-slate-700 mb-2">è‡¨åºŠæ‡‰ç”¨ç¯„ä¾‹ï¼š</h4>
                        <ul class="list-disc list-inside text-sm text-slate-600" id="hierarchy-examples">
                            <li>ç­‰å¾…äº’å‹•...</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: ADVANCED (NEW) -->
        <section id="advanced" class="hidden fade-in">
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-slate-800 border-l-4 border-indigo-600 pl-4">äº’é€šæ€§éµä¸‰è§’ï¼šFHIR, SNOMED CT èˆ‡
                    CQL</h2>
                <p class="mt-2 text-slate-600 text-lg">
                    è¦å¯¦ç¾çœŸæ­£çš„æ™ºæ…§é†«ç™‚ï¼Œæˆ‘å€‘éœ€è¦ä¸‰å€‹å±¤æ¬¡æ¨™æº–çš„çµåˆã€‚é€™ä¸åƒ…æ˜¯å‚³è¼¸è³‡æ–™ï¼Œæ›´æ˜¯é—œæ–¼ã€ŒçŸ¥è­˜çš„å¯è¨ˆç®—æ€§ (Computable Knowledge)ã€ã€‚
                </p>
            </div>

            <!-- Conceptual Stack Visualization -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-12">
                <!-- Layer 3: Logic -->
                <div class="logic-block bg-white p-6 rounded-lg shadow border-t-8 border-indigo-500 relative">
                    <div
                        class="absolute -top-4 -right-4 bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold">
                        3</div>
                    <h3 class="text-xl font-bold text-indigo-700 mb-2">CQL (é‚è¼¯å±¤)</h3>
                    <p class="text-xs font-mono bg-slate-100 p-2 rounded mb-2 text-slate-600">Clinical Quality Language
                    </p>
                    <p class="text-sm text-slate-600">
                        <strong>å¤§è…¦èˆ‡è¦å‰‡ã€‚</strong><br>
                        å®šç¾©ã€Œåšä»€éº¼ã€ã€‚å®ƒè®€å–è³‡æ–™ä¸¦åŸ·è¡Œé‚è¼¯åˆ¤æ–·ã€‚ä¾‹å¦‚ï¼šã€Œå¦‚æœç—…æ‚£æ‚£æœ‰ç³–å°¿ç—…ä¸” HbA1c > 9%ï¼Œå‰‡å»ºè­°èª¿æ•´è—¥ç‰©ã€ã€‚
                    </p>
                </div>
                <!-- Layer 2: Semantics -->
                <div class="logic-block bg-white p-6 rounded-lg shadow border-t-8 border-teal-500 relative">
                    <div
                        class="absolute -top-4 -right-4 bg-teal-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold">
                        2</div>
                    <h3 class="text-xl font-bold text-teal-700 mb-2">SNOMED CT (èªæ„å±¤)</h3>
                    <p class="text-xs font-mono bg-slate-100 p-2 rounded mb-2 text-slate-600">Value Sets / Codes</p>
                    <p class="text-sm text-slate-600">
                        <strong>è©å½™èˆ‡å®šç¾©ã€‚</strong><br>
                        å®šç¾©ã€Œæ˜¯ä»€éº¼ã€ã€‚é€éæ¨™æº–ä»£ç¢¼èˆ‡éšå±¤é—œä¿‚ï¼Œè®“é›»è…¦çŸ¥é“ã€ŒType 2 Diabetesã€ä¹Ÿæ˜¯ä¸€ç¨®ã€ŒDiabetesã€ã€‚
                    </p>
                </div>
                <!-- Layer 1: Structure -->
                <div class="logic-block bg-white p-6 rounded-lg shadow border-t-8 border-amber-500 relative">
                    <div
                        class="absolute -top-4 -right-4 bg-amber-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold">
                        1</div>
                    <h3 class="text-xl font-bold text-amber-700 mb-2">FHIR (çµæ§‹å±¤)</h3>
                    <p class="text-xs font-mono bg-slate-100 p-2 rounded mb-2 text-slate-600">Resources / API</p>
                    <p class="text-sm text-slate-600">
                        <strong>å®¹å™¨èˆ‡å‚³è¼¸ã€‚</strong><br>
                        å®šç¾©ã€Œæ€éº¼è£ã€ã€‚æä¾›æ¨™æº–çš„è³‡æ–™æ ¼å¼ (JSON/XML) ä¾†æ‰¿è¼‰ç—…æ‚£è³‡æ–™èˆ‡ SNOMED ä»£ç¢¼ã€‚
                    </p>
                </div>
            </div>

            <!-- Interactive CQL Engine Sandbox -->
            <div class="bg-slate-900 rounded-xl p-6 md:p-8 shadow-2xl text-slate-200">
                <div class="flex flex-col md:flex-row justify-between items-end mb-6 border-b border-slate-700 pb-4">
                    <div>
                        <h3 class="text-2xl font-bold text-white">ğŸ§® CQL é‚è¼¯æ¨è«–æ¨¡æ“¬å™¨</h3>
                        <p class="text-slate-400 text-sm mt-1">é«”é©— SNOMED CT çš„éšå±¤é—œä¿‚ (Hierarchy) å¦‚ä½•è³¦äºˆ CQL å¼·å¤§çš„æŸ¥è©¢èƒ½åŠ›ã€‚</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Left: Logic Definition -->
                    <div class="space-y-6">
                        <div class="bg-slate-800 p-4 rounded-lg border border-slate-700">
                            <label class="block text-indigo-400 text-sm font-bold mb-2">1. å®šç¾© CQL è¦å‰‡ (Logic)</label>
                            <p class="text-xs text-slate-400 mb-3">ç›®æ¨™ï¼šæ‰¾å‡ºæ‰€æœ‰ã€Œç³–å°¿ç—…ã€æ‚£è€… (åŒ…å«æ‰€æœ‰å­é¡å‹)ã€‚</p>
                            <div class="font-mono text-sm bg-black p-3 rounded border-l-4 border-indigo-500">
                                <span class="text-pink-400">define</span> "Is Diabetic":<br>
                                &nbsp;&nbsp;<span class="text-blue-400">exists</span> ([Condition: Code <span
                                    class="text-yellow-400">in</span> "Diabetes Mellitus Value Set"])
                            </div>
                            <p class="text-xs text-slate-500 mt-2">
                                * "in" é‹ç®—å­æœƒé€é SNOMED CT è‡ªå‹•åŒ…å«æ‰€æœ‰ä¸‹ä½æ¦‚å¿µã€‚
                            </p>
                        </div>

                        <div class="bg-slate-800 p-4 rounded-lg border border-slate-700">
                            <label class="block text-amber-400 text-sm font-bold mb-2">2. è¼¸å…¥ FHIR ç—…æ­·è³‡æ–™ (Data)</label>
                            <label class="text-xs text-slate-400 block mb-2">é¸æ“‡ç—…äººçš„è¨ºæ–·ä»£ç¢¼ï¼š</label>
                            <select id="cql-patient-select"
                                class="w-full bg-slate-900 border border-slate-600 text-white rounded p-2 mb-2 focus:ring-2 focus:ring-indigo-500 outline-none">
                                <option value="dm2">44054006 | Type 2 diabetes mellitus (ç¬¬äºŒå‹ç³–å°¿ç—…)</option>
                                <option value="dm1">46635009 | Type 1 diabetes mellitus (ç¬¬ä¸€å‹ç³–å°¿ç—…)</option>
                                <option value="retinopathy">4855003 | Diabetic retinopathy (ç³–å°¿ç—…è¦–ç¶²è†œç—…è®Š)</option>
                                <option value="asthma">195967001 | Asthma (æ°£å–˜)</option>
                            </select>
                            <button onclick="runCQL()"
                                class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 rounded transition shadow-lg mt-2">
                                åŸ·è¡Œ CQL æ¨è«– &rarr;
                            </button>
                        </div>
                    </div>

                    <!-- Right: Execution Result -->
                    <div class="bg-black p-4 rounded-lg border border-slate-700 relative min-h-[300px] flex flex-col">
                        <span class="text-xs text-slate-500 absolute top-2 right-3">Console / Engine Output</span>

                        <div id="cql-output-initial"
                            class="flex-grow flex items-center justify-center text-slate-600 text-sm italic">
                            ç­‰å¾…åŸ·è¡Œ...<br>è«‹é¸æ“‡ç—…æ­·ä¸¦é»æ“ŠåŸ·è¡Œ
                        </div>

                        <div id="cql-output-result" class="hidden font-mono text-sm space-y-3">
                            <div class="border-b border-slate-800 pb-2">
                                <span class="text-slate-400">> è¼‰å…¥ SNOMED CT æœ¬é«”è«–... </span><span
                                    class="text-green-500">OK</span><br>
                                <span class="text-slate-400">> è¼‰å…¥ Value Set "Diabetes"... </span><span
                                    class="text-green-500">OK (åŒ…å« 80+ å­æ¦‚å¿µ)</span>
                            </div>

                            <div>
                                <span class="text-blue-400">INPUT FHIR Resource:</span><br>
                                <span class="text-slate-300">Condition.code = </span> <span class="text-yellow-300"
                                    id="cql-code-display"></span>
                            </div>

                            <div class="pl-4 border-l-2 border-slate-700">
                                <span class="text-slate-400">é‚è¼¯åˆ¤æ–·:</span><br>
                                æª¢æŸ¥ä»£ç¢¼ <span id="cql-check-code" class="text-yellow-300"></span> æ˜¯å¦å±¬æ–¼ "Diabetes"?<br>
                                <span class="text-purple-400">SNOMED Engine:</span> æŸ¥è©¢ Is-a é—œä¿‚...
                                <div id="cql-relationship" class="text-slate-300 my-1"></div>
                            </div>

                            <div class="mt-4 pt-2 border-t border-slate-700">
                                <span class="text-slate-400">RESULT:</span>
                                <span id="cql-final-result" class="text-2xl font-bold ml-2"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 3: COMPARISON (Governance) -->
        <section id="comparison" class="hidden fade-in">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-slate-800 border-l-4 border-blue-600 pl-4">è³‡æ–™æ²»ç†ï¼šICD èˆ‡ SNOMED CT çš„å·®ç•°
                </h2>
                <p class="mt-2 text-slate-600">
                    å°ç£ç¾è¡Œçš„é†«ç™‚è³‡æ–™ä¸»è¦ä¾è³´ ICD-10 é€²è¡Œç”³å ±ã€‚ICD çš„è¨­è¨ˆæ˜¯ç‚ºäº†<strong>çµ±è¨ˆèˆ‡è¨ˆè²»</strong>ï¼Œé¡†ç²’åº¦ï¼ˆGranularityï¼‰ä¸è¶³ã€‚
                    SNOMED CT å‰‡å°ˆæ³¨æ–¼<strong>è‡¨åºŠç´€éŒ„</strong>ï¼Œèƒ½è§£æ±ºè³‡æ–™æ²»ç†ä¸­ã€Œç´°ç¯€æµå¤±ã€çš„å•é¡Œã€‚
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <!-- Data Point 1 -->
                <div
                    class="col-span-1 bg-blue-50 p-4 rounded-lg border border-blue-100 shadow-sm relative overflow-hidden">
                    <div
                        class="absolute top-0 right-0 bg-blue-200 text-blue-800 text-xs font-bold px-2 py-1 rounded-bl">
                        å¥ä¿ VPN</div>
                    <h4 class="font-bold text-blue-800 mb-1">ICD-10-CM (å¥ä¿ç¢¼)</h4>
                    <p class="text-sm text-blue-600 font-semibold mb-2">ç›®çš„ï¼šæ”¯ä»˜ (Payment)ã€çµ±è¨ˆ</p>
                    <p class="text-xs text-slate-600 mb-2">åƒæ˜¯ä¸€å€‹ã€Œæª”æ¡ˆæ«ƒçš„æ¨™ç±¤ã€ï¼Œå°‡ç›¸ä¼¼çš„ç–¾ç—…æ­¸åœ¨åŒä¸€é¡ã€‚å°ç£å¥ä¿ä¾æ­¤çµ¦ä»˜é»æ•¸ã€‚</p>
                    <div class="bg-white p-2 rounded border border-blue-200 mt-2">
                        <p class="text-xs font-mono text-slate-500">Code: J18.9</p>
                        <p class="text-xs font-bold text-slate-700">Pneumonia, unspecified</p>
                        <p class="text-[10px] text-red-500 mt-1">ç„¡æ³•å€åˆ†è‡´ç—…èŒã€éƒ¨ä½ã€‚</p>
                    </div>
                </div>
                <!-- Arrow -->
                <div class="col-span-1 flex items-center justify-center text-slate-400">
                    <div class="text-center">
                        <p class="text-2xl font-bold">VS</p>
                        <p class="text-xs">äº’è£œè€Œéå–ä»£</p>
                    </div>
                </div>
                <!-- Data Point 2 -->
                <div
                    class="col-span-1 bg-teal-50 p-4 rounded-lg border border-teal-100 shadow-sm relative overflow-hidden">
                    <div
                        class="absolute top-0 right-0 bg-teal-200 text-teal-800 text-xs font-bold px-2 py-1 rounded-bl">
                        é›»å­ç—…æ­· EMR</div>
                    <h4 class="font-bold text-teal-800 mb-1">SNOMED CT (è‡¨åºŠç¢¼)</h4>
                    <p class="text-sm text-teal-600 font-semibold mb-2">ç›®çš„ï¼šç…§è­· (Care)ã€ç²¾æº–é†«ç™‚</p>
                    <p class="text-xs text-slate-600 mb-2">åƒæ˜¯ä¸€å€‹ã€Œç²¾å¯†çš„æŒ‡ç´‹ã€ï¼Œèƒ½å¤ æè¿°ç–¾ç—…çš„ä½ç½®ã€æˆå› ã€åš´é‡ç¨‹åº¦ç­‰å…·é«”å±¬æ€§ã€‚</p>
                    <div class="bg-white p-2 rounded border border-teal-200 mt-2">
                        <p class="text-xs font-mono text-slate-500">Code: 444645005</p>
                        <p class="text-xs font-bold text-slate-700">Viral pneumonia of left lower lobe</p>
                        <p class="text-[10px] text-green-600 mt-1">æ¸…æ¥šæ¨™ç¤ºï¼šç—…æ¯’æ€§ã€å·¦ä¸‹è‚ºè‘‰ã€‚</p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-sm mb-6">
                <h3 class="text-lg font-bold text-slate-700 mb-4 text-center">é¡†ç²’åº¦æ¯”è¼ƒï¼šä»£ç¢¼æ•¸é‡ç´šå·®ç•°</h3>
                <div class="chart-container">
                    <canvas id="comparisonChart"></canvas>
                </div>
            </div>
        </section>

        <!-- SECTION 4: SIMULATOR (Basic) -->
        <section id="simulator" class="hidden fade-in">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-slate-800 border-l-4 border-amber-500 pl-4">äº’é€šæ€§æ¨¡æ“¬å™¨ï¼šå¾æœ¬åœ°åˆ°åœ‹éš›</h2>
                <p class="mt-2 text-slate-600">
                    æ­¤æ¨¡æ“¬å™¨å±•ç¤ºå¦‚ä½•å°‡æœ¬åœ°è¼¸å…¥è½‰æ›ç‚º SNOMED CT ä¸¦ç”Ÿæˆ FHIR æ ¼å¼ã€‚
                    (æ¬²äº†è§£æ›´æ·±å…¥çš„é‚è¼¯æ¨è«–ï¼Œè«‹åƒè¦‹ã€Œé€²éšï¼šFHIR/CQLã€åˆ†é )
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- INPUT -->
                <div class="bg-white p-6 rounded-lg shadow-md border border-slate-200">
                    <h3 class="text-lg font-bold text-slate-700 mb-4 border-b pb-2">ğŸ©º æ­¥é©Ÿ 1: é†«å¸«è‡¨åºŠè¼¸å…¥</h3>
                    <select id="diagnosis-select"
                        class="w-full p-3 border border-slate-300 rounded-md shadow-sm focus:ring-teal-500 bg-slate-50 mb-6"
                        onchange="runSimulation()">
                        <option value="" disabled selected>-- è«‹é¸æ“‡è¨ºæ–· --</option>
                        <option value="dm2">Type 2 Diabetes Mellitus</option>
                        <option value="pneumonia">Viral Pneumonia (Left Lower Lobe)</option>
                        <option value="covid">COVID-19 Confirmed</option>
                        <option value="ami">Acute Myocardial Infarction</option>
                    </select>

                    <div id="local-display" class="hidden">
                        <div class="bg-slate-100 p-4 rounded text-sm text-slate-600 font-mono">
                            <p><span class="font-bold text-slate-800">Local Text:</span> <span id="local-text"></span>
                            </p>
                            <p class="mt-2"><span class="font-bold text-slate-800">ICD-10-CM:</span> <span
                                    id="local-icd" class="bg-blue-100 text-blue-800 px-2 py-1 rounded"></span></p>
                        </div>
                    </div>
                </div>

                <!-- OUTPUT -->
                <div
                    class="bg-slate-900 p-6 rounded-lg shadow-md text-green-400 font-mono text-sm overflow-hidden relative">
                    <h3 class="text-lg font-bold text-white mb-4 border-b border-slate-700 pb-2">ğŸŒ æ­¥é©Ÿ 2: FHIR JSON</h3>
                    <div id="fhir-output" class="hidden">
                        <pre class="whitespace-pre-wrap break-all" id="json-code"></pre>
                    </div>
                    <div id="fhir-placeholder" class="text-slate-500 italic h-32 flex items-center justify-center">
                        ç­‰å¾…è¼¸å…¥...</div>
                </div>
            </div>
        </section>

        <!-- SECTION 5: ROADMAP -->
        <section id="roadmap" class="hidden fade-in">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-slate-800 border-l-4 border-purple-600 pl-4">å°ç£ SNOMED CT ç™¼å±•è·¯å¾‘ (æ¥è»Œ TW
                    Core IG)</h2>
                <p class="mt-2 text-slate-600">
                    é€™ä¸åƒ…æ˜¯æŠ€è¡“çš„å‡ç´šï¼Œæ›´æ˜¯å°ç£é†«ç™‚è³‡è¨ŠåŸºç¤å»ºè¨­çš„åå¹´å¤§è¨ˆã€‚å¾åŠ å…¥åœ‹éš›çµ„ç¹”åˆ° TW Core IG çš„å¯¦è³ªè½åœ°ã€‚
                </p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-md mb-6">
                <div id="roadmapChart" style="width:100%; height:400px;"></div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                <div class="bg-purple-50 p-4 rounded border border-purple-100">
                    <h4 class="font-bold text-purple-800 mb-2">è¿‘æœŸé‡Œç¨‹ç¢‘ï¼šTW Core IG</h4>
                    <p class="text-sm text-slate-600">
                        å°ç£æ ¸å¿ƒå¯¦ä½œæŒ‡å¼• (TW Core IG) å·²æ­£å¼æ¡ç´ SNOMED CT ä½œç‚ºå¤šå€‹ Resource çš„ç¶å®šè¡“èªã€‚ä¾‹å¦‚ï¼š
                        AllergyIntolerance (éæ•)ã€Condition (è¨ºæ–·)ã€Procedure (è™•ç½®)ã€‚é€™æ„å‘³è‘—æœªä¾†é†«é™¢è‹¥è¦é€šéäº’é€šæ€§é©—è­‰ï¼ŒSNOMED æ˜¯å¿…è€ƒé¡Œã€‚
                    </p>
                </div>
                <div class="bg-indigo-50 p-4 rounded border border-indigo-100">
                    <h4 class="font-bold text-indigo-800 mb-2">æœªä¾†é¡˜æ™¯ï¼šæ¬¡ä¸–ä»£å¥ä¿</h4>
                    <p class="text-sm text-slate-600">
                        é€é FHIR + SNOMED å¯¦ç¾ã€Œæ­¸æˆ¶å¾Œçš„ç²¾æº–å¥åº·è³‡æ–™åº«ã€ã€‚ä¸å†åªæœ‰ç”³å ±æ•¸æ“šï¼Œè€Œæ˜¯åŒ…å«è‡¨åºŠç´°ç¯€çš„çœŸå¯¦ä¸–ç•Œæ•¸æ“š (RWD)ï¼Œé€™å°‡å¤§å¹…åŠ é€Ÿå°ç£çš„æ–°è—¥ç ”ç™¼èˆ‡ AI æ¨¡å‹è¨“ç·´ã€‚
                    </p>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-slate-800 text-slate-300 py-6 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-sm">SNOMED CT, FHIR èˆ‡ CQL é†«ç™‚è³‡æ–™æ²»ç†äº’é€šæ€§åˆ†æå¹³å°</p>
        </div>
    </footer>

    <!-- Application Logic -->
    <script>
        // --- State Management ---
        const state = {
            activeTab: 'overview',
            hierarchyChartInstance: null,
            comparisonChartInstance: null
        };

        // --- Data Store ---
        const reportData = {
            hierarchy: {
                labels: ['Clinical finding (è‡¨åºŠç™¼ç¾)', 'Procedure (è™•ç½®)', 'Body structure (çµæ§‹)', 'Substance (ç‰©è³ª)', 'Organism (ç”Ÿç‰©)', 'Pharm/bio (è—¥ç‰©)', 'Other'],
                data: [115000, 60000, 35000, 28000, 35000, 20000, 57000],
                descriptions: [
                    "åŒ…å«ç–¾ç—…ã€ç—‡ç‹€ã€‚CQL å¸¸åœ¨æ­¤å±¤ç´šé€²è¡Œç¯©é¸ (ä¾‹å¦‚ï¼šç¯©é¸æ‰€æœ‰é«˜è¡€å£“æ‚£è€…)ã€‚",
                    "é†«ç™‚è¡Œç‚ºã€‚å¯ç”¨æ–¼ CQL å“è³ªæŒ‡æ¨™ (ä¾‹å¦‚ï¼šæ˜¯å¦åŸ·è¡Œäº†ç³–å°¿ç—…è¶³éƒ¨æª¢æŸ¥)ã€‚",
                    "è§£å‰–çµæ§‹ã€‚ç”¨æ–¼å®šç¾©ç–¾ç—…éƒ¨ä½ã€‚",
                    "åŒ–å­¸ç‰©è³ªã€‚ç”¨æ–¼éæ•åŸæª¢æŸ¥ã€‚",
                    "ç—…åŸé«”ã€‚ç”¨æ–¼å¾®ç”Ÿç‰©å ±å‘Šäº’é€šã€‚",
                    "è—¥å“ã€‚CQL å¯ç”¨æ–¼è—¥ç‰©äº¤äº’ä½œç”¨æª¢æŸ¥ã€‚",
                    "å…¶ä»–æƒ…å¢ƒå€¼èˆ‡å±¬æ€§ã€‚"
                ],
                examples: [
                    "ä¾‹ï¼šViral pneumonia (ç—…æ¯’æ€§è‚ºç‚)",
                    "ä¾‹ï¼šAppendectomy (é—Œå°¾åˆ‡é™¤è¡“)",
                    "ä¾‹ï¼šLeft ventricle (å·¦å¿ƒå®¤)",
                    "ä¾‹ï¼šInsulin (èƒ°å³¶ç´ )",
                    "ä¾‹ï¼šS. pneumoniae (è‚ºç‚éˆçƒèŒ)",
                    "ä¾‹ï¼šParacetamol (ä¹™é†¯èƒºé…š)",
                    "ä¾‹ï¼šHistory of (ç—…å²)"
                ]
            },
            comparison: {
                labels: ['ICD-10 (è¨ˆè²»)', 'SNOMED CT (è‡¨åºŠ)'],
                data: [14000, 350000]
            },
            simulator: {
                dm2: { text: "Type 2 Diabetes", icd: "E11.9", sctCode: "44054006", sctDisplay: "Type 2 diabetes mellitus (disorder)" },
                pneumonia: { text: "Viral Pneumonia LLL", icd: "J12.9 (Unspecified)", sctCode: "444645005", sctDisplay: "Viral pneumonia of left lower lobe (disorder)" },
                covid: { text: "COVID-19 Confirmed", icd: "U07.1", sctCode: "840539006", sctDisplay: "Disease caused by SARS-CoV-2" },
                ami: { text: "Acute MI", icd: "I21.9", sctCode: "57054005", sctDisplay: "Acute myocardial infarction" }
            },
            cqlLogic: {
                dm2: { isMatch: true, reason: "IS-A Diabetes Mellitus (44054006 < 73211009)" },
                dm1: { isMatch: true, reason: "IS-A Diabetes Mellitus (46635009 < 73211009)" },
                retinopathy: { isMatch: true, reason: "IS-A Diabetes Mellitus (Complication link)" }, // Simplified for demo
                asthma: { isMatch: false, reason: "Not a subtype of Diabetes Mellitus" }
            }
        };

        // --- Navigation Logic ---
        function switchTab(tabId) {
            document.querySelectorAll('main > section').forEach(sec => sec.classList.add('hidden'));
            document.querySelectorAll('.nav-item').forEach(btn => {
                btn.classList.remove('active-nav', 'text-teal-600');
                btn.classList.add('text-slate-500');
                // Special handling for the Advanced tab styling
                if (btn.id === 'nav-advanced') {
                    btn.classList.remove('bg-teal-100');
                    btn.classList.add('bg-teal-50');
                }
            });

            document.getElementById(tabId).classList.remove('hidden');
            const activeBtn = document.getElementById(`nav-${tabId}`);
            if (activeBtn) {
                activeBtn.classList.add('active-nav', 'text-teal-600');
                activeBtn.classList.remove('text-slate-500');
                if (tabId === 'advanced') {
                    activeBtn.classList.add('bg-teal-100');
                }
            }

            document.getElementById('mobile-menu').classList.add('hidden');
            state.activeTab = tabId;

            if (tabId === 'structure' && !state.hierarchyChartInstance) renderHierarchyChart();
            if (tabId === 'comparison' && !state.comparisonChartInstance) renderComparisonChart();
            if (tabId === 'roadmap') renderRoadmapChart();
        }

        function toggleMobileMenu() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        }

        // --- Visualization: Structure ---
        function renderHierarchyChart() {
            const ctx = document.getElementById('hierarchyChart').getContext('2d');
            state.hierarchyChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: reportData.hierarchy.labels,
                    datasets: [{
                        data: reportData.hierarchy.data,
                        backgroundColor: ['#0d9488', '#0f766e', '#3b82f6', '#6366f1', '#8b5cf6', '#ec4899', '#94a3b8'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { boxWidth: 10 } } },
                    onClick: (event, elements) => {
                        if (elements.length > 0) updateHierarchyDetail(elements[0].index);
                    }
                }
            });
        }

        function updateHierarchyDetail(index) {
            document.getElementById('hierarchy-title').innerText = reportData.hierarchy.labels[index];
            document.getElementById('hierarchy-title').classList.add('text-teal-700');
            document.getElementById('hierarchy-desc').innerText = reportData.hierarchy.descriptions[index];
            document.getElementById('hierarchy-examples').innerHTML = `<li class="font-semibold text-teal-700">${reportData.hierarchy.examples[index]}</li>`;
            document.getElementById('hierarchy-detail').classList.add('border-teal-500');
            document.getElementById('hierarchy-stats').classList.remove('hidden');
        }

        // --- Visualization: Comparison ---
        function renderComparisonChart() {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            state.comparisonChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: reportData.comparison.labels,
                    datasets: [{
                        label: 'æ¦‚å¿µæ•¸é‡ (Log Scale)',
                        data: reportData.comparison.data,
                        backgroundColor: ['#3b82f6', '#0d9488'],
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { type: 'logarithmic' } },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // --- Visualization: Roadmap ---
        function renderRoadmapChart() {
            if (document.getElementById('roadmapChart').data) return;
            const trace = {
                x: ['2023', '2024', '2025', '2026', '2028', '2030'],
                y: [1, 2, 3, 4, 5, 5.5],
                text: ['åŠ å…¥ SNOMED Int.', 'æˆç«‹ NRC', 'TW Core IG è½åœ°', 'FHIR äº¤æ›å¹³å°è©¦è¾¦', 'æ¬¡ä¸–ä»£å¥ä¿æ•´åˆ', 'å…¨äººç²¾æº–å¥åº·'],
                mode: 'markers+text',
                textposition: 'top center',
                marker: { size: 25, color: ['#94a3b8', '#94a3b8', '#3b82f6', '#0d9488', '#0d9488', '#7c3aed'] },
                type: 'scatter'
            };
            Plotly.newPlot('roadmapChart', [trace], {
                title: 'å°ç£é†«ç™‚è³‡è¨Šæ¨™æº–åŒ–é€²ç¨‹',
                xaxis: { range: ['2023', '2031'] },
                yaxis: { showgrid: false, zeroline: false, showticklabels: false, range: [0, 6] },
                margin: { l: 20, r: 20, t: 40, b: 20 }
            }, { responsive: true, displayModeBar: false });
        }

        // --- Logic: CQL Sandbox (NEW) ---
        function runCQL() {
            const select = document.getElementById('cql-patient-select');
            const key = select.value;
            const logic = reportData.cqlLogic[key];
            const text = select.options[select.selectedIndex].text;

            // UI Update
            document.getElementById('cql-output-initial').classList.add('hidden');
            document.getElementById('cql-output-result').classList.remove('hidden');

            // Set Loading state slightly
            document.getElementById('cql-final-result').innerText = "...";
            document.getElementById('cql-final-result').className = "text-2xl font-bold ml-2 text-slate-400";

            setTimeout(() => {
                // Display Code
                document.getElementById('cql-code-display').innerText = text;
                document.getElementById('cql-check-code').innerText = text.split('|')[0].trim();

                // Display Reason
                if (logic.isMatch) {
                    document.getElementById('cql-relationship').innerHTML = `<span class="text-green-400">âœ” Found Relationship:</span> ${logic.reason}`;
                    document.getElementById('cql-final-result').innerHTML = `<span class="text-green-500">TRUE (ç¬¦åˆ)</span>`;
                } else {
                    document.getElementById('cql-relationship').innerHTML = `<span class="text-red-400">âœ˜ No Relationship:</span> ${logic.reason}`;
                    document.getElementById('cql-final-result').innerHTML = `<span class="text-red-500">FALSE (ä¸ç¬¦åˆ)</span>`;
                }
            }, 500);
        }

        // --- Logic: Simulator (Basic) ---
        function runSimulation() {
            const select = document.getElementById('diagnosis-select');
            const key = select.value;
            if (!key) return;
            const data = reportData.simulator[key];

            document.getElementById('local-display').classList.remove('hidden');
            document.getElementById('local-text').innerText = data.text;
            document.getElementById('local-icd').innerText = data.icd;

            document.getElementById('fhir-placeholder').classList.remove('hidden');
            document.getElementById('fhir-output').classList.add('hidden');
            document.getElementById('fhir-placeholder').innerText = "Processing...";

            setTimeout(() => {
                document.getElementById('fhir-placeholder').classList.add('hidden');
                document.getElementById('fhir-output').classList.remove('hidden');
                const json = {
                    "resourceType": "Condition",
                    "code": {
                        "coding": [{ "system": "http://snomed.info/sct", "code": data.sctCode, "display": data.sctDisplay }]
                    },
                    "subject": { "reference": "Patient/123" }
                };
                document.getElementById('json-code').innerText = JSON.stringify(json, null, 2);
            }, 600);
        }

        window.addEventListener('resize', () => {
            if (state.activeTab === 'roadmap') Plotly.Plots.resize('roadmapChart');
        });
    </script>
</body>

</html>